---
services:
  main:
    lifecycle:
      install:
        all: echo All installed
    dependencies:
      - aws.greengrass.clientdevices.Auth
  aws.greengrass.Nucleus:
    configuration:
      runWithDefault:
        posixUser: nobody
        windowsUser: integ-tester
      logging:
        level: "DEBUG"
  aws.greengrass.clientdevices.Auth:
    configuration:
      deviceGroups:
        formatVersion: "2021-03-05"
        definitions:
          devices:
            selectionRule: "thingName: mockThing"
            policyName: "allowPublishMetrics"
        policies:
          allowPublishMetrics:
            allowConnect:
              statementDescription: "allow client devices to connect"
              operations:
                - "mqtt:connect"
              resources:
                - "*"
            allowPublish:
              statementDescription: "allow client devices to publish to all topics"
              operations:
                - "mqtt:publish"
              resources:
                - "*"
      metrics:
        disableMetrics: "false"
        aggregationPeriodSeconds: "2"